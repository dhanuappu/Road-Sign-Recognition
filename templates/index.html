<!DOCTYPE html>
<html>
<head>
    <title>Road Sign AI</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body style="background:#000; color:#0f0; text-align:center; font-family:sans-serif;">
    <h1>ROAD SIGN AI</h1>
    <video id="v" autoplay playsinline style="width:90%; border:2px solid #0f0; border-radius:10px;"></video>
    <canvas id="c" style="display:none;"></canvas>
    
    <div style="margin:20px; padding:20px; background:#111; border-radius:10px;">
        <h2 id="st">Awaiting Camera...</h2>
    </div>

    <div style="display:flex; flex-wrap:wrap; justify-content:center; gap:10px;">
        <button onclick="setL('en')">English</button>
        <button onclick="setL('hi')">Hindi</button>
        <button onclick="setL('kn')">Kannada</button>
        <button onclick="setL('ta')">Tamil</button>
        <button onclick="setL('te')">Telugu</button>
    </div>

    <script>
        const v = document.getElementById('v');
        const c = document.getElementById('c');
        const st = document.getElementById('st');
        let cur = "";

        navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}})
            .then(s => { 
                v.srcObject = s; 
                setInterval(upload, 500); 
            });

        function upload() {
            c.width = 300; c.height = 300;
            c.getContext('2d').drawImage(v, 0, 0, 300, 300);
            fetch('/process_frame', {
                method: 'POST',
                headers: {'Content-Type':'application/json'},
                body: JSON.stringify({image: c.toDataURL('image/jpeg', 0.5)})
            });
        }

        setInterval(() => {
            fetch('/get_detection').then(r => r.json()).then(d => {
                if(d.sign !== cur) {
                    cur = d.sign;
                    st.innerText = d.sign;
                    new Audio('/static/announcement.mp3?t=' + Date.now()).play();
                }
            });
        }, 800);

        function setL(l) { fetch('/set_language/'+l); }
    </script>
</body>
</html>